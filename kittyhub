-- Crown Hub 2026 - Optimized & Aggressive
-- Fixed with Advanced Features

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")

local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- Premium GUI Setup
local CrownHub = Instance.new("ScreenGui")
CrownHub.Name = "CrownHub2026"
CrownHub.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
CrownHub.DisplayOrder = 999
CrownHub.Parent = player:WaitForChild("PlayerGui")

-- Main Container with Fixed Glass Morphism
local MainContainer = Instance.new("Frame")
MainContainer.Size = UDim2.new(0, 500, 0, 600)
MainContainer.Position = UDim2.new(0.5, -250, 0.5, -300)
MainContainer.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
MainContainer.BackgroundTransparency = 0.15
MainContainer.BorderSizePixel = 0
MainContainer.ClipsDescendants = true
MainContainer.Parent = CrownHub

-- Fixed Aurora Gradient Background
local GradientFrame = Instance.new("Frame")
GradientFrame.Size = UDim2.new(1, 0, 1, 0)
GradientFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
GradientFrame.BorderSizePixel = 0
GradientFrame.ZIndex = 0
GradientFrame.Parent = MainContainer

local RoyalGradient = Instance.new("UIGradient")
RoyalGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(25, 10, 40)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(40, 15, 60)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(25, 10, 40))
})
RoyalGradient.Rotation = 45
RoyalGradient.Parent = GradientFrame

-- Subtle Gradient Animation
spawn(function()
    while CrownHub.Parent do
        for i = 0, 360, 0.5 do
            RoyalGradient.Rotation = i
            RunService.RenderStepped:Wait()
        end
    end
end)

-- Glass Overlay
local GlassLayer = Instance.new("Frame")
GlassLayer.Size = UDim2.new(1, 0, 1, 0)
GlassLayer.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
GlassLayer.BackgroundTransparency = 0.95
GlassLayer.BorderSizePixel = 0
GlassLayer.ZIndex = 2
GlassLayer.Parent = MainContainer

-- Premium Border
local PremiumBorder = Instance.new("Frame")
PremiumBorder.Size = UDim2.new(1, 4, 1, 4)
PremiumBorder.Position = UDim2.new(0, -2, 0, -2)
PremiumBorder.BackgroundColor3 = Color3.fromRGB(255, 215, 0)
PremiumBorder.BackgroundTransparency = 0.8
PremiumBorder.BorderSizePixel = 0
PremiumBorder.ZIndex = -1
PremiumBorder.Parent = MainContainer

-- Corner Radius
local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 16)
Corner.Parent = MainContainer

local BorderCorner = Instance.new("UICorner")
BorderCorner.CornerRadius = UDim.new(0, 18)
BorderCorner.Parent = PremiumBorder

-- Crown Header
local Header = Instance.new("Frame")
Header.Size = UDim2.new(1, 0, 0, 60)
Header.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
Header.BackgroundTransparency = 0.2
Header.BorderSizePixel = 0
Header.ZIndex = 10
Header.Parent = MainContainer

local HeaderGradient = Instance.new("UIGradient")
HeaderGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(50, 25, 75)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(25, 50, 100))
})
HeaderGradient.Rotation = 90
HeaderGradient.Parent = Header

-- Crown Icon
local CrownIcon = Instance.new("TextLabel")
CrownIcon.Size = UDim2.new(0, 40, 0, 40)
CrownIcon.Position = UDim2.new(0, 15, 0, 10)
CrownIcon.BackgroundTransparency = 1
CrownIcon.Text = "👑"
CrownIcon.TextColor3 = Color3.fromRGB(255, 215, 0)
CrownIcon.TextSize = 30
CrownIcon.Font = Enum.Font.GothamBlack
CrownIcon.ZIndex = 11
CrownIcon.Parent = Header

-- Title
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -80, 1, 0)
Title.Position = UDim2.new(0, 65, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "CROWN HUB 2026"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 20
Title.Font = Enum.Font.GothamBlack
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.ZIndex = 11
Title.Parent = Header

local Subtitle = Instance.new("TextLabel")
Subtitle.Size = UDim2.new(1, -80, 0, 20)
Subtitle.Position = UDim2.new(0, 65, 0, 35)
Subtitle.BackgroundTransparency = 1
Subtitle.Text = "Aggressive Dominance Suite"
Subtitle.TextColor3 = Color3.fromRGB(200, 200, 255)
Subtitle.TextSize = 12
Subtitle.Font = Enum.Font.GothamMedium
Subtitle.TextXAlignment = Enum.TextXAlignment.Left
Subtitle.ZIndex = 11
Subtitle.Parent = Header

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 15)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.BackgroundTransparency = 0.2
CloseButton.Text = "×"
CloseButton.TextColor3 = Color3.new(1, 1, 1)
CloseButton.TextSize = 18
CloseButton.Font = Enum.Font.GothamBlack
CloseButton.ZIndex = 11
CloseButton.Parent = Header

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

-- Navigation Tabs
local TabContainer = Instance.new("Frame")
TabContainer.Size = UDim2.new(1, -20, 0, 35)
TabContainer.Position = UDim2.new(0, 10, 0, 70)
TabContainer.BackgroundTransparency = 1
TabContainer.ZIndex = 10
TabContainer.Parent = MainContainer

-- Content Area
local ContentFrame = Instance.new("ScrollingFrame")
ContentFrame.Size = UDim2.new(1, -20, 1, -125)
ContentFrame.Position = UDim2.new(0, 10, 0, 115)
ContentFrame.BackgroundTransparency = 1
ContentFrame.ScrollBarThickness = 4
ContentFrame.ScrollBarImageColor3 = Color3.fromRGB(255, 215, 0)
ContentFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
ContentFrame.ZIndex = 10
ContentFrame.Parent = MainContainer

local ContentLayout = Instance.new("UIListLayout")
ContentLayout.Padding = UDim.new(0, 10)
ContentLayout.Parent = ContentFrame

-- Optimized Tabs
local Tabs = {
    "Fling System",
    "Movement", 
    "Visual",
    "Combat",
    "Advanced"
}

local CurrentTab = "Fling System"

-- Create Premium Tabs
for i, tabName in ipairs(Tabs) do
    local TabButton = Instance.new("TextButton")
    TabButton.Size = UDim2.new(1/#Tabs, -6, 1, 0)
    TabButton.Position = UDim2.new((i-1)/#Tabs, 0, 0, 0)
    TabButton.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    TabButton.BackgroundTransparency = 0.3
    TabButton.Text = tabName
    TabButton.TextColor3 = Color3.fromRGB(200, 200, 200)
    TabButton.Font = Enum.Font.GothamMedium
    TabButton.TextSize = 12
    TabButton.AutoButtonColor = false
    TabButton.ZIndex = 11
    TabButton.Parent = TabContainer
    
    local TabCorner = Instance.new("UICorner")
    TabCorner.CornerRadius = UDim.new(0, 8)
    TabCorner.Parent = TabButton
    
    TabButton.MouseButton1Click:Connect(function()
        CurrentTab = tabName
        UpdateContent()
        UpdateTabAppearance()
    end)
end

function UpdateTabAppearance()
    for _, tab in ipairs(TabContainer:GetChildren()) do
        if tab:IsA("TextButton") then
            if tab.Text == CurrentTab then
                TweenService:Create(tab, TweenInfo.new(0.3), {
                    BackgroundColor3 = Color3.fromRGB(255, 215, 0),
                    TextColor3 = Color3.fromRGB(20, 20, 20),
                    BackgroundTransparency = 0.1
                }):Play()
            else
                TweenService:Create(tab, TweenInfo.new(0.3), {
                    BackgroundColor3 = Color3.fromRGB(30, 30, 40),
                    TextColor3 = Color3.fromRGB(200, 200, 200),
                    BackgroundTransparency = 0.3
                }):Play()
            end
        end
    end
end

-- AGGRESSIVE FLING SYSTEM
local FlingActive = false
local LoopFlingActive = false
local SpinActive = false
local CollisionActive = false
local AntiFlingActive = false

-- Advanced Collision System
local function EnableCollision()
    CollisionActive = true
    for _, target in ipairs(Players:GetPlayers()) do
        if target.Character then
            for _, part in pairs(target.Character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = true
                    part.Massless = false
                end
            end
        end
    end
end

-- Anti-Fling Protection
local function EnableAntiFling()
    AntiFlingActive = true
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local root = player.Character.HumanoidRootPart
        spawn(function()
            while AntiFlingActive and player.Character do
                -- Constantly reset velocity to prevent flinging
                for _, v in pairs(root:GetChildren()) do
                    if v:IsA("BodyVelocity") then
                        v:Destroy()
                    end
                end
                RunService.Heartbeat:Wait()
            end
        end)
    end
end

-- Aggressive Spin System
local function AggressiveSpin()
    SpinActive = true
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end
    
    local root = player.Character.HumanoidRootPart
    local originalPosition = root.Position
    
    spawn(function()
        while SpinActive and player.Character do
            -- Fast spin without losing position
            root.CFrame = root.CFrame * CFrame.Angles(0, math.rad(50), 0)
            
            -- Maintain position to prevent flying away
            root.Velocity = Vector3.new(0, 0, 0)
            root.RotVelocity = Vector3.new(0, 0, 0)
            
            RunService.Heartbeat:Wait()
        end
    end)
end

-- Aggressive Fling System
local function AggressiveFling()
    FlingActive = true
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end
    
    local root = player.Character.HumanoidRootPart
    
    spawn(function()
        while FlingActive and player.Character do
            for _, target in ipairs(Players:GetPlayers()) do
                if target ~= player and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
                    local targetRoot = target.Character.HumanoidRootPart
                    
                    -- Aggressive teleport fling
                    local angle = tick() * 20 -- Faster rotation
                    local radius = 3 -- Closer for more aggressive fling
                    local offset = Vector3.new(
                        math.cos(angle) * radius,
                        2,
                        math.sin(angle) * radius
                    )
                    
                    -- Teleport to target
                    root.CFrame = targetRoot.CFrame + offset
                    
                    -- Apply aggressive fling force
                    local bv = Instance.new("BodyVelocity")
                    bv.Velocity = Vector3.new(
                        math.random(-200, 200),  -- More horizontal force
                        math.random(100, 250),   -- More upward force
                        math.random(-200, 200)
                    )
                    bv.MaxForce = Vector3.new(20000, 20000, 20000)
                    bv.Parent = targetRoot
                    game.Debris:AddItem(bv, 0.05) -- Shorter duration for more chaos
                end
            end
            RunService.Heartbeat:Wait()
        end
    end)
end

-- Loop Fling System
local function LoopFling()
    LoopFlingActive = true
    if not player.Character then return end
    
    local root = player.Character.HumanoidRootPart
    
    spawn(function()
        while LoopFlingActive and player.Character do
            -- Aggressive self-fling motion
            local bv = Instance.new("BodyVelocity")
            bv.Velocity = Vector3.new(
                math.sin(tick() * 15) * 150,  -- Faster, stronger
                math.cos(tick() * 8) * 80 + 40,
                math.cos(tick() * 15) * 150
            )
            bv.MaxForce = Vector3.new(50000, 50000, 50000)
            bv.Parent = root
            game.Debris:AddItem(bv, 0.1)
            RunService.Heartbeat:Wait()
        end
    end)
end

-- Advanced Fly System with Ctrl+F
local FlyEnabled = false
local function ToggleFly()
    FlyEnabled = not FlyEnabled
    
    if FlyEnabled then
        -- Enable fly mode
        local bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.Velocity = Vector3.new(0, 0, 0)
        bodyVelocity.MaxForce = Vector3.new(0, 0, 0)
        
        local connection
        connection = RunService.Heartbeat:Connect(function()
            if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then 
                connection:Disconnect()
                return 
            end
            
            local root = player.Character.HumanoidRootPart
            
            -- Ctrl+F fly controls
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) and UserInputService:IsKeyDown(Enum.KeyCode.F) then
                bodyVelocity.Velocity = Vector3.new(0, 50, 0) -- Fly up
                bodyVelocity.MaxForce = Vector3.new(0, 100000, 0)
            elseif UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) and UserInputService:IsKeyDown(Enum.KeyCode.F) then
                bodyVelocity.Velocity = Vector3.new(0, -50, 0) -- Fly down
                bodyVelocity.MaxForce = Vector3.new(0, 100000, 0)
            else
                bodyVelocity.MaxForce = Vector3.new(0, 0, 0) -- Stop flying
            end
        end)
    end
end

-- OPTIMIZED FUNCTIONAL FEATURES
local CrownFunctions = {
    ["Fling System"] = {
        {"💀 Aggressive Player Fling", function()
            FlingActive = not FlingActive
            if FlingActive then
                AggressiveFling()
            end
        end},
        
        {"🌪️ Loop Self Fling", function()
            LoopFlingActive = not LoopFlingActive
            if LoopFlingActive then
                LoopFling()
            end
        end},
        
        {"🌀 Aggressive Spin", function()
            SpinActive = not SpinActive
            if SpinActive then
                AggressiveSpin()
            end
        end},
        
        {"🔒 Enable Collision (All)", function()
            EnableCollision()
        end},
        
        {"🛡️ Anti-Fling Protection", function()
            AntiFlingActive = not AntiFlingActive
            if AntiFlingActive then
                EnableAntiFling()
            end
        end},
        
        {"🛑 Stop All Fling", function()
            FlingActive = false
            LoopFlingActive = false
            SpinActive = false
            AntiFlingActive = false
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local root = player.Character.HumanoidRootPart
                for _, v in ipairs(root:GetChildren()) do
                    if v:IsA("BodyVelocity") then
                        v:Destroy()
                    end
                end
            end
        end}
    },
    
    Movement = {
        {"🚀 Fly (Ctrl+F/Shift+F)", function()
            ToggleFly()
        end},
        
        {"⚡ Speed Boost (150)", function()
            if player.Character and player.Character:FindFirstChild("Humanoid") then
                player.Character.Humanoid.WalkSpeed = 150
            end
        end},
        
        {"👻 Noclip Toggle", function()
            local noclip = false
            player.CharacterAdded:Connect(function(char)
                if noclip then
                    wait(0.5)
                    for _, part in pairs(char:GetDescendants()) do
                        if part:IsA("BasePart") then
                            part.CanCollide = false
                        end
                    end
                end
            end)
            
            noclip = not noclip
            if player.Character then
                for _, part in pairs(player.Character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = not noclip
                    end
                end
            end
        end},
        
        {"🔄 Reset Movement", function()
            if player.Character and player.Character:FindFirstChild("Humanoid") then
                player.Character.Humanoid.WalkSpeed = 16
            end
        end}
    },
    
    Visual = {
        {"🎯 Simple ESP", function()
            for _, target in ipairs(Players:GetPlayers()) do
                if target ~= player and target.Character then
                    local highlight = Instance.new("Highlight")
                    highlight.FillColor = Color3.fromRGB(255, 215, 0)
                    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                    highlight.FillTransparency = 0.4
                    highlight.Parent = target.Character
                end
            end
        end},
        
        {"👁️ X-Ray Vision", function()
            for _, part in pairs(workspace:GetDescendants()) do
                if part:IsA("BasePart") and part.Transparency < 1 then
                    part.LocalTransparencyModifier = 0.6
                end
            end
        end},
        
        {"🌟 Full Bright", function()
            Lighting.Brightness = 2
            Lighting.Ambient = Color3.new(1, 1, 1)
        end},
        
        {"🗑️ Clear Visuals", function()
            for _, target in ipairs(Players:GetPlayers()) do
                if target.Character then
                    for _, highlight in ipairs(target.Character:GetChildren()) do
                        if highlight:IsA("Highlight") then
                            highlight:Destroy()
                        end
                    end
                end
            end
            for _, part in pairs(workspace:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.LocalTransparencyModifier = 0
                end
            end
            Lighting.Brightness = 1
        end}
    },
    
    Combat = {
        {"🎯 Venum Aim", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/spicysharwarma-stack/VENUM.AIM/main/MAINCODE"))()
        end},
        
        {"🔫 Infinite Yield", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))()
        end}
    },
    
    Advanced = {
        {"🛡️ Anti-AFK", function()
            local VirtualUser = game:GetService("VirtualUser")
            player.Idled:Connect(function()
                VirtualUser:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
                wait(1)
                VirtualUser:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
            end)
        end},
        
        {"🔧 FPS Unlocker", function()
            setfpscap(999)
        end},
        
        {"🎮 Ctrl+Click TP", function()
            local connection
            connection = UserInputService.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 and 
                   UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
                    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                        player.Character.HumanoidRootPart.CFrame = CFrame.new(mouse.Hit.X, mouse.Hit.Y + 3, mouse.Hit.Z)
                    end
                end
            end)
        end},
        
        {"🔄 Reset Character", function()
            if player.Character then
                player.Character:BreakJoints()
            end
        end}
    }
}

function UpdateContent()
    for _, child in ipairs(ContentFrame:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    
    local functions = CrownFunctions[CurrentTab] or {}
    
    for _, func in ipairs(functions) do
        CreatePremiumButton(func[1], func[2])
    end
end

function CreatePremiumButton(text, callback)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, 0, 0, 45)
    button.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    button.BackgroundTransparency = 0.2
    button.Text = text
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Font = Enum.Font.GothamMedium
    button.TextSize = 14
    button.AutoButtonColor = false
    button.ZIndex = 11
    button.Parent = ContentFrame
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 10)
    buttonCorner.Parent = button
    
    -- Button Hover Effects
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.3), {
            BackgroundTransparency = 0.1,
            BackgroundColor3 = Color3.fromRGB(40, 40, 50)
        }):Play()
    end)
    
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.3), {
            BackgroundTransparency = 0.2,
            BackgroundColor3 = Color3.fromRGB(30, 30, 40)
        }):Play()
    end)
    
    button.MouseButton1Click:Connect(function()
        -- Click animation
        TweenService:Create(button, TweenInfo.new(0.1), {
            BackgroundColor3 = Color3.fromRGB(255, 215, 0)
        }):Play()
        wait(0.1)
        TweenService:Create(button, TweenInfo.new(0.3), {
            BackgroundColor3 = Color3.fromRGB(30, 30, 40)
        }):Play()
        
        pcall(callback)
    end)
end

-- Drag System
local dragging = false
local dragStart, startPos

Header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainContainer.Position
    end
end)

Header.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

Header.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
        local delta = input.Position - dragStart
        MainContainer.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- Close Button
CloseButton.MouseButton1Click:Connect(function()
    TweenService:Create(MainContainer, TweenInfo.new(0.3), {
        Size = UDim2.new(0, 0, 0, 0),
        Position = UDim2.new(0.5, 0, 0.5, 0)
    }):Play()
    wait(0.3)
    CrownHub:Destroy()
end)

-- Entrance Animation
MainContainer.Size = UDim2.new(0, 0, 0, 0)
MainContainer.Position = UDim2.new(0.5, 0, 0.5, 0)

TweenService:Create(MainContainer, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
    Size = UDim2.new(0, 500, 0, 600),
    Position = UDim2.new(0.5, -250, 0.5, -300)
}):Play()

-- Initialize
UpdateContent()
UpdateTabAppearance()

print("👑 Crown Hub 2026 - Aggressive & Optimized!")
print("💀 Aggressive Fling System Ready")
print("🎯 Venum Aim Loaded")
print("⚡ 150 Speed & Advanced Features")
