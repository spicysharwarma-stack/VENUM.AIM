-- Crown Hub 2026 - Universal Edition
-- Enhanced for PC & Mobile with Universal Scripts

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local CoreGui = game:GetService("CoreGui")

local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- GUI Setup (Load into CoreGui for always on top)
local CrownHub = Instance.new("ScreenGui")
CrownHub.Name = "CrownHubUniversal"
CrownHub.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
CrownHub.DisplayOrder = 1000  -- Highest priority
CrownHub.ResetOnSpawn = false
CrownHub.Parent = CoreGui  -- Changed to CoreGui for universal access

-- Mobile detection
local IS_MOBILE = UserInputService.TouchEnabled

-- Responsive sizing
local SCREEN_WIDTH = workspace.CurrentCamera.ViewportSize.X
local UI_SCALE = IS_MOBILE and math.min(SCREEN_WIDTH / 1200, 0.8) or 1
local UI_WIDTH = IS_MOBILE and 380 or 450
local UI_HEIGHT = IS_MOBILE and 480 or 520

-- Main Container with responsive positioning
local MainContainer = Instance.new("Frame")
MainContainer.Size = UDim2.new(0, UI_WIDTH * UI_SCALE, 0, UI_HEIGHT * UI_SCALE)
MainContainer.Position = UDim2.new(0.5, -(UI_WIDTH * UI_SCALE) / 2, 0.5, -(UI_HEIGHT * UI_SCALE) / 2)
MainContainer.BackgroundColor3 = Color3.fromRGB(15, 12, 18)
MainContainer.BackgroundTransparency = 0.05
MainContainer.BorderSizePixel = 0
MainContainer.ClipsDescendants = true
MainContainer.Parent = CrownHub

-- FIXED: IMPROVED GLOWING EDGE EFFECT
local EdgeGlow = Instance.new("Frame")
EdgeGlow.Size = UDim2.new(1, 12, 1, 12)
EdgeGlow.Position = UDim2.new(0, -6, 0, -6)
EdgeGlow.BackgroundColor3 = Color3.fromRGB(255, 215, 0)
EdgeGlow.BackgroundTransparency = 0.7
EdgeGlow.BorderSizePixel = 0
EdgeGlow.ZIndex = -2
EdgeGlow.Parent = MainContainer

-- Add UIStroke for proper glow effect
local EdgeStroke = Instance.new("UIStroke")
EdgeStroke.Color = Color3.fromRGB(255, 215, 0)
EdgeStroke.Thickness = 6
EdgeStroke.Transparency = 0.5
EdgeStroke.Parent = MainContainer

-- Add inner glow
local InnerGlow = Instance.new("Frame")
InnerGlow.Size = UDim2.new(1, 0, 1, 0)
InnerGlow.BackgroundColor3 = Color3.fromRGB(255, 215, 0)
InnerGlow.BackgroundTransparency = 0.95
InnerGlow.BorderSizePixel = 0
InnerGlow.ZIndex = 3
InnerGlow.Parent = MainContainer

local EdgeGlowCorner = Instance.new("UICorner")
EdgeGlowCorner.CornerRadius = UDim.new(0, 20)
EdgeGlowCorner.Parent = EdgeGlow

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainContainer

-- Glow animation
spawn(function()
    while CrownHub.Parent do
        TweenService:Create(EdgeGlow, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
            BackgroundTransparency = 0.4,
            BackgroundColor3 = Color3.fromRGB(255, 255, 150)
        }):Play()
        TweenService:Create(EdgeStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
            Transparency = 0.2,
            Color = Color3.fromRGB(255, 255, 200)
        }):Play()
        TweenService:Create(InnerGlow, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
            BackgroundTransparency = 0.9
        }):Play()
        wait(1.5)
        
        TweenService:Create(EdgeGlow, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
            BackgroundTransparency = 0.7,
            BackgroundColor3 = Color3.fromRGB(255, 215, 0)
        }):Play()
        TweenService:Create(EdgeStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
            Transparency = 0.5,
            Color = Color3.fromRGB(255, 215, 0)
        }):Play()
        TweenService:Create(InnerGlow, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
            BackgroundTransparency = 0.95
        }):Play()
        wait(1.5)
    end
end)

-- Make UI draggable on mobile
if IS_MOBILE then
    local function onTouch(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            local touchPos = input.Position
            MainContainer.Position = UDim2.new(0, touchPos.X - (MainContainer.Size.X.Offset / 2), 0, touchPos.Y - (MainContainer.Size.Y.Offset / 2))
        end
    end
    
    -- Make header draggable
    MainContainer.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            local dragConnection
            dragConnection = input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragConnection:Disconnect()
                else
                    onTouch(input)
                end
            end)
        end
    end)
end

-- FIXED: Proper Gradient Background
local GradientBackground = Instance.new("Frame")
GradientBackground.Size = UDim2.new(1, 0, 1, 0)
GradientBackground.Position = UDim2.new(0, 0, 0, 0)
GradientBackground.BackgroundColor3 = Color3.fromRGB(25, 20, 30)
GradientBackground.BorderSizePixel = 0
GradientBackground.ZIndex = 0
GradientBackground.Parent = MainContainer

local MainGradient = Instance.new("UIGradient")
MainGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(40, 25, 50)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(60, 35, 80)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(30, 20, 40))
})
MainGradient.Rotation = 45
MainGradient.Parent = GradientBackground

-- FIXED: Better Moving Overlay
local MovingOverlay = Instance.new("Frame")
MovingOverlay.Size = UDim2.new(2, 0, 2, 0)
MovingOverlay.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
MovingOverlay.BackgroundTransparency = 0.9
MovingOverlay.BorderSizePixel = 0
MovingOverlay.ZIndex = 1
MovingOverlay.Parent = MainContainer

local OverlayGradient = Instance.new("UIGradient")
OverlayGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(120, 80, 160)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(80, 120, 200)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(160, 100, 120))
})
OverlayGradient.Transparency = NumberSequence.new({
    NumberSequenceKeypoint.new(0, 0.8),
    NumberSequenceKeypoint.new(0.5, 0.6),
    NumberSequenceKeypoint.new(1, 0.8)
})
OverlayGradient.Parent = MovingOverlay

-- FIXED: Smooth Gradient Animation
spawn(function()
    local time = 0
    while CrownHub.Parent do
        time = time + 0.02
        
        -- Move overlay smoothly across the screen
        local x = math.sin(time * 0.5) * 0.3
        local y = math.cos(time * 0.3) * 0.3
        MovingOverlay.Position = UDim2.new(x, 0, y, 0)
        
        -- Rotate gradients for flowing effect
        MainGradient.Rotation = (MainGradient.Rotation + 0.2) % 360
        OverlayGradient.Rotation = (OverlayGradient.Rotation - 0.3) % 360
        
        RunService.Heartbeat:Wait()
    end
end)

-- Gold Border
local GoldBorder = Instance.new("Frame")
GoldBorder.Size = UDim2.new(1, 6, 1, 6)
GoldBorder.Position = UDim2.new(0, -3, 0, -3)
GoldBorder.BackgroundColor3 = Color3.fromRGB(212, 175, 55)
GoldBorder.BackgroundTransparency = 0.3
GoldBorder.BorderSizePixel = 0
GoldBorder.ZIndex = -1
GoldBorder.Parent = MainContainer

local BorderCorner = Instance.new("UICorner")
BorderCorner.CornerRadius = UDim.new(0, 16)
BorderCorner.Parent = GoldBorder

-- Glass Overlay
local GlassLayer = Instance.new("Frame")
GlassLayer.Size = UDim2.new(1, 0, 1, 0)
GlassLayer.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
GlassLayer.BackgroundTransparency = 0.95
GlassLayer.BorderSizePixel = 0
GlassLayer.ZIndex = 2
GlassLayer.Parent = MainContainer

-- Header (responsive height)
local Header = Instance.new("Frame")
Header.Size = UDim2.new(1, 0, 0, IS_MOBILE and 60 or 70)
Header.BackgroundColor3 = Color3.fromRGB(25, 20, 30)
Header.BackgroundTransparency = 0.1
Header.BorderSizePixel = 0
Header.ZIndex = 10
Header.Parent = MainContainer

-- FIXED: Better Header Gradient
local HeaderGradient = Instance.new("UIGradient")
HeaderGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(50, 30, 70)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(35, 20, 50))
})
HeaderGradient.Rotation = 90
HeaderGradient.Parent = Header

-- Crown Icon (responsive size)
local CrownIcon = Instance.new("ImageLabel")
CrownIcon.Size = UDim2.new(0, IS_MOBILE and 35 or 40, 0, IS_MOBILE and 35 or 40)
CrownIcon.Position = UDim2.new(0, 10, 0, IS_MOBILE and 12 or 15)
CrownIcon.BackgroundTransparency = 1
CrownIcon.Image = "rbxassetid://6031075938"
CrownIcon.ImageColor3 = Color3.fromRGB(255, 215, 0)
CrownIcon.ZIndex = 11
CrownIcon.Parent = Header

-- Crown Animation
spawn(function()
    while CrownHub.Parent do
        TweenService:Create(CrownIcon, TweenInfo.new(1.5, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), {
            Rotation = 5,
            ImageColor3 = Color3.fromRGB(255, 230, 100)
        }):Play()
        wait(1.5)
        TweenService:Create(CrownIcon, TweenInfo.new(1.5, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), {
            Rotation = -5,
            ImageColor3 = Color3.fromRGB(255, 215, 0)
        }):Play()
        wait(1.5)
    end
end)

-- Title (responsive font sizes)
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -70, 0, IS_MOBILE and 25 or 35)
Title.Position = UDim2.new(0, IS_MOBILE and 50 or 60, 0, IS_MOBILE and 5 or 8)
Title.BackgroundTransparency = 1
Title.Text = "CROWN HUB"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = IS_MOBILE and 18 or 24
Title.Font = Enum.Font.GothamBlack
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.TextStrokeColor3 = Color3.fromRGB(255, 215, 0)
Title.TextStrokeTransparency = 0.7
Title.ZIndex = 11
Title.Parent = Header

local Subtitle = Instance.new("TextLabel")
Subtitle.Size = UDim2.new(1, -70, 0, 18)
Subtitle.Position = UDim2.new(0, IS_MOBILE and 50 or 60, 0, IS_MOBILE and 30 or 40)
Subtitle.BackgroundTransparency = 1
Subtitle.Text = IS_MOBILE and "Universal Edition" or "Universal Edition"
Subtitle.TextColor3 = Color3.fromRGB(200, 180, 255)
Subtitle.TextSize = IS_MOBILE and 9 or 11
Subtitle.Font = Enum.Font.GothamMedium
Subtitle.TextXAlignment = Enum.TextXAlignment.Left
Subtitle.ZIndex = 11
Subtitle.Parent = Header

-- Control Buttons (responsive size)
local ControlContainer = Instance.new("Frame")
ControlContainer.Size = UDim2.new(0, IS_MOBILE and 55 or 70, 0, IS_MOBILE and 25 or 30)
ControlContainer.Position = UDim2.new(1, IS_MOBILE and -60 or -75, 0, IS_MOBILE and 17 or 20)
ControlContainer.BackgroundTransparency = 1
ControlContainer.ZIndex = 11
ControlContainer.Parent = Header

local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Size = UDim2.new(0, IS_MOBILE and 25 or 30, 0, IS_MOBILE and 25 or 30)
MinimizeButton.Position = UDim2.new(0, 0, 0, 0)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(212, 175, 55)
MinimizeButton.BackgroundTransparency = 0.2
MinimizeButton.Text = "_"
MinimizeButton.TextColor3 = Color3.new(1, 1, 1)
MinimizeButton.TextSize = IS_MOBILE and 14 or 16
MinimizeButton.Font = Enum.Font.GothamBlack
MinimizeButton.ZIndex = 11
MinimizeButton.Parent = ControlContainer

local MinimizeCorner = Instance.new("UICorner")
MinimizeCorner.CornerRadius = UDim.new(0, 6)
MinimizeCorner.Parent = MinimizeButton

local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, IS_MOBILE and 25 or 30, 0, IS_MOBILE and 25 or 30)
CloseButton.Position = UDim2.new(0, IS_MOBILE and 28 or 35, 0, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(180, 60, 60)
CloseButton.BackgroundTransparency = 0.2
CloseButton.Text = "Ã—"
CloseButton.TextColor3 = Color3.new(1, 1, 1)
CloseButton.TextSize = IS_MOBILE and 16 or 18
CloseButton.Font = Enum.Font.GothamBlack
CloseButton.ZIndex = 11
CloseButton.Parent = ControlContainer

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

-- Navigation Tabs (responsive height)
local TabContainer = Instance.new("Frame")
TabContainer.Size = UDim2.new(1, -20, 0, IS_MOBILE and 28 or 32)
TabContainer.Position = UDim2.new(0, 10, 0, IS_MOBILE and 70 or 80)
TabContainer.BackgroundTransparency = 1
TabContainer.ZIndex = 10
TabContainer.Parent = MainContainer

-- Content Area (responsive positioning)
local ContentFrame = Instance.new("ScrollingFrame")
ContentFrame.Size = UDim2.new(1, -20, 1, IS_MOBILE and -98 or -122)
ContentFrame.Position = UDim2.new(0, 10, 0, IS_MOBILE and 108 or 122)
ContentFrame.BackgroundTransparency = 1
ContentFrame.ScrollBarThickness = IS_MOBILE and 3 or 4
ContentFrame.ScrollBarImageColor3 = Color3.fromRGB(212, 175, 55)
ContentFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
ContentFrame.ZIndex = 10
ContentFrame.Parent = MainContainer

local ContentLayout = Instance.new("UIListLayout")
ContentLayout.Padding = UDim.new(0, IS_MOBILE and 8 or 10)
ContentLayout.Parent = ContentFrame

-- Tabs (Updated)
local Tabs = {
    "Fling",
    "Admin", 
    "Movement",
    "Visual",
    "Combat",
    "Hubs",
    "Fun"
}

local CurrentTab = "Fling"

-- Create Tabs (responsive font size)
for i, tabName in ipairs(Tabs) do
    local TabButton = Instance.new("TextButton")
    TabButton.Size = UDim2.new(1/#Tabs, -4, 1, 0)
    TabButton.Position = UDim2.new((i-1)/#Tabs, 0, 0, 0)
    TabButton.BackgroundColor3 = Color3.fromRGB(35, 30, 45)
    TabButton.BackgroundTransparency = 0.3
    TabButton.Text = tabName
    TabButton.TextColor3 = Color3.fromRGB(200, 190, 220)
    TabButton.Font = Enum.Font.GothamMedium
    TabButton.TextSize = IS_MOBILE and 10 or 11
    TabButton.AutoButtonColor = false
    TabButton.ZIndex = 11
    TabButton.Parent = TabContainer
    
    local TabCorner = Instance.new("UICorner")
    TabCorner.CornerRadius = UDim.new(0, 6)
    TabCorner.Parent = TabButton
    
    -- Tab Hover
    TabButton.MouseEnter:Connect(function()
        if TabButton.Text ~= CurrentTab then
            TweenService:Create(TabButton, TweenInfo.new(0.3), {
                BackgroundTransparency = 0.1,
                TextColor3 = Color3.fromRGB(255, 255, 255)
            }):Play()
        end
    end)
    
    TabButton.MouseLeave:Connect(function()
        if TabButton.Text ~= CurrentTab then
            TweenService:Create(TabButton, TweenInfo.new(0.3), {
                BackgroundTransparency = 0.3,
                TextColor3 = Color3.fromRGB(200, 190, 220)
            }):Play()
        end
    end)
    
    TabButton.MouseButton1Click:Connect(function()
        CurrentTab = tabName
        UpdateContent()
        UpdateTabAppearance()
    end)
end

function UpdateTabAppearance()
    for _, tab in ipairs(TabContainer:GetChildren()) do
        if tab:IsA("TextButton") then
            if tab.Text == CurrentTab then
                TweenService:Create(tab, TweenInfo.new(0.3), {
                    BackgroundColor3 = Color3.fromRGB(212, 175, 55),
                    TextColor3 = Color3.fromRGB(20, 15, 25),
                    BackgroundTransparency = 0.1
                }):Play()
            else
                TweenService:Create(tab, TweenInfo.new(0.3), {
                    BackgroundColor3 = Color3.fromRGB(35, 30, 45),
                    TextColor3 = Color3.fromRGB(200, 190, 220),
                    BackgroundTransparency = 0.3
                }):Play()
            end
        end
    end
end

-- UNIVERSAL VEHICLE SCRIPT (To Open And Close Gui)
local VehicleScriptLoaded = false
local function LoadUniversalVehicle()
    if not VehicleScriptLoaded then
        VehicleScriptLoaded = true
        loadstring(game:HttpGet('https://raw.githubusercontent.com/Documantation12/Universal-Vehicle-Script/main/Main.lua'))()
    end
end

-- TENNA DANCE SCRIPT
local function TennaDance()
    local plr = game.Players.LocalPlayer
    if plr.Character and plr.Character:FindFirstChild("Humanoid") then
        local hum = plr.Character.Humanoid
        local Anim = Instance.new("Animation")
        Anim.AnimationId = "rbxassetid://75202452138001"
        local track = hum:LoadAnimation(Anim)
        track:Play()
        track:AdjustSpeed(1.524)
    end
end

-- INFLUENCE V1 ESP + Hitbox
local function LoadInfluenceESP()
    loadstring(game:HttpGet('https://pastebin.com/raw/KXQE4WDS'))()
end

-- ULTRA SIGMA HAX V2 (Prison Life Aimbot)
local PrisonAimbotLoaded = false
local function LoadUltraSigmaHax()
    if getgenv().haxloaded then
        return
    end

    if getcustomasset or getgenv().getcustomasset then
        local getasset = getcustomasset or getgenv().getcustomasset
        
        spawn(function()
            local encoded = game:HttpGet("https://raw.githubusercontent.com/UltraFEmotes/test/refs/heads/main/welcome.txt")
            if not encoded or encoded == "" then return end
            
            writefile("Welcome.mp3", base64decode(encoded))
           task.wait(0.5)
            
            local asset_id = getasset("Welcome.mp3")
            local sound = Instance.new("Sound")
            sound.SoundId = asset_id
            sound.Volume = 1
            sound.Looped = false
            sound.Parent = workspace
            sound:Play()
            
            sound.Ended:Connect(function()
                sound:Destroy()
            end)
        end)
    end
    getgenv().haxloaded = true
    local sextoy = Instance.new("Message")
    sextoy.Parent = workspace
    sextoy.Text = "ULTRA SIGMA HAX V2 >:3c"
    task.wait(2)
    sextoy.Text = "Made by White Cat :3c"
    task.wait(1.6)
    sextoy:Destroy()
    local function processPart(obj)
        if obj:IsA("BasePart") then
            task.spawn(function()
                while true do
                    for i = 0, 1, 0.01 do
                        obj.Color = Color3.fromHSV(i, 1, 1)
                        task.wait(0.02)
                    end
                end
            end)
            obj.Transparency = 0.5
            obj.CanCollide = false
        end
    end
    local function recursiveProcess(obj)
        processPart(obj)
        for _, child in ipairs(obj:GetChildren()) do
            recursiveProcess(child)
        end
    end
    for _, v in pairs(workspace.Prison_OuterWall.prison_wall:GetChildren()) do
        recursiveProcess(v)
    end
    for _, v in pairs(workspace.Prison_guardtower:GetChildren()) do
        recursiveProcess(v)
    end
    for _, v in pairs(workspace.Prison_Fences:GetChildren()) do
        if v.Name == "fence" then
            recursiveProcess(v)
            local dmg = v:FindFirstChild("damagePart")
            if dmg then
                local ti = dmg:FindFirstChild("TouchInterest")
                if ti then
                    ti:Destroy()
                end
            end
        end
    end
    local doors = workspace:FindFirstChild("Doors")
    if doors then
        doors:Destroy()
    end
    task.spawn(function()
        while task.wait() do
            if game.Players.LocalPlayer and game.Players.LocalPlayer.Character then
                local hum = game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
                if hum then
                    hum.WalkSpeed = 25
                    game.Players.LocalPlayer:SetAttribute("BackpackEnabled", true)
                    hum.JumpHeight = 5.5
                end
                if game.Players.LocalPlayer.Character:FindFirstChild("AntiJump") then
                    game.Players.LocalPlayer.Character.AntiJump:Destroy()
                end
            end
        end
    end)
    local Players = game:GetService("Players")
    local RunService = game:GetService("RunService")
    local LocalPlayer = Players.LocalPlayer
    local ESP_ENABLED = false
    local TELEPORT_COOLDOWN = 1.6
    local lastTeleport = 0
    local function GetBillboard(targetCharacter)
        local head = targetCharacter:FindFirstChild("Head")
        if not head then
            return nil
        end
        local billboard = head:FindFirstChild("AntigravityESP_Billboard")
        if not billboard then
            billboard = Instance.new("BillboardGui")
            billboard.Name = "AntigravityESP_Billboard"
            billboard.Adornee = head
            billboard.Size = UDim2.new(0, 200, 0, 120)
            billboard.StudsOffset = Vector3.new(0, 3, 0)
            billboard.AlwaysOnTop = true
            billboard.Parent = head
            local emojiLabel = Instance.new("TextLabel")
            emojiLabel.Name = "EmojiLabel"
            emojiLabel.Size = UDim2.new(1, 0, 0.35, 0)
            emojiLabel.Position = UDim2.new(0, 0, 0, 0)
            emojiLabel.BackgroundTransparency = 1
            emojiLabel.TextColor3 = Color3.new(1, 1, 1)
            emojiLabel.TextStrokeTransparency = 0
            emojiLabel.Font = Enum.Font.GothamBold
            emojiLabel.TextSize = 24
            emojiLabel.Parent = billboard
            local nameLabel = Instance.new("TextLabel")
            nameLabel.Name = "NameLabel"
            nameLabel.Size = UDim2.new(1, 0, 0.35, 0)
            nameLabel.Position = UDim2.new(0, 0, 0.35, 0)
            nameLabel.BackgroundTransparency = 1
            nameLabel.TextColor3 = Color3.new(1, 1, 1)
            nameLabel.TextStrokeTransparency = 0
            nameLabel.Font = Enum.Font.GothamBold
            nameLabel.TextSize = 14
            nameLabel.Parent = billboard
            local healthBarBG = Instance.new("Frame")
            healthBarBG.Name = "HealthBarBG"
            healthBarBG.Size = UDim2.new(0.8, 0, 0.12, 0)
            healthBarBG.Position = UDim2.new(0.1, 0, 0.75, 0)
            healthBarBG.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            healthBarBG.BorderSizePixel = 0
            healthBarBG.Parent = billboard
            local healthBarFill = Instance.new("Frame")
            healthBarFill.Name = "HealthBarFill"
            healthBarFill.Size = UDim2.new(1, 0, 1, 0)
            healthBarFill.Position = UDim2.new(0, 0, 0, 0)
            healthBarFill.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
            healthBarFill.BorderSizePixel = 0
            healthBarFill.Parent = healthBarBG
            local healthBarCorner = Instance.new("UICorner")
            healthBarCorner.CornerRadius = UDim.new(0, 3)
            healthBarCorner.Parent = healthBarBG
            local healthBarFillCorner = Instance.new("UICorner")
            healthBarFillCorner.CornerRadius = UDim.new(0, 3)
            healthBarFillCorner.Parent = healthBarFill
        end
        return billboard
    end
    local function GetCham(targetCharacter)
        local cham = targetCharacter:FindFirstChild("AntigravityESP_Cham")
        if not cham then
            cham = Instance.new("Highlight")
            cham.Name = "AntigravityESP_Cham"
            cham.Adornee = targetCharacter
            cham.Parent = targetCharacter
            cham.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        end
        return cham
    end
    local function UpdateESP()
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character then
                local billboard = GetBillboard(player.Character)
                local cham = GetCham(player.Character)
                if billboard and cham then
                    if ESP_ENABLED then
                        billboard.Enabled = true
                        cham.Enabled = true
                        local nameLabel = billboard:FindFirstChild("NameLabel")
                        local emojiLabel = billboard:FindFirstChild("EmojiLabel")
                        local healthBarFill = billboard:FindFirstChild("HealthBarBG") and billboard.HealthBarBG:FindFirstChild("HealthBarFill")
                        local teamName = player.Team and player.Team.Name or "Neutral"
                        local displayText = player.Name
                        local emojiText = ""
                        local color = Color3.new(1, 1, 1)
                        if teamName == "Inmates" then
                            color = Color3.fromRGB(255, 170, 0)
                            displayText = displayText .. " [Inmate]"
                            local isHostile = player.Character:GetAttribute("Hostile")
                            local isTrespassing = player.Character:GetAttribute("Trespassing")
                            if isHostile then
                                emojiText = emojiText .. "ðŸ’¢"
                            end
                            if isTrespassing then
                                emojiText = emojiText .. "ðŸ”—"
                            end
                        elseif teamName == "Guards" then
                            color = Color3.fromRGB(0, 100, 255)
                            displayText = displayText .. " [Guards]"
                        elseif teamName == "Criminals" then
                            color = Color3.fromRGB(255, 50, 50)
                            displayText = displayText .. " [Criminals]"
                        else
                            displayText = displayText .. " [" .. teamName .. "]"
                        end
                        nameLabel.Text = displayText
                        nameLabel.TextColor3 = color
                        emojiLabel.Text = emojiText
                        cham.FillColor = color
                        cham.OutlineColor = color
                        cham.FillTransparency = 0.5
                        cham.OutlineTransparency = 0
                        local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
                        if humanoid and healthBarFill then
                            local healthPercent = math.clamp(humanoid.Health / humanoid.MaxHealth, 0, 1)
                            healthBarFill.Size = UDim2.new(healthPercent, 0, 1, 0)
                            if healthPercent > 0.5 then
                                healthBarFill.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
                            elseif healthPercent > 0.25 then
                                healthBarFill.BackgroundColor3 = Color3.fromRGB(255, 255, 0)
                            else
                                healthBarFill.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
                            end
                        end
                    else
                        billboard.Enabled = false
                        cham.Enabled = false
                    end
                end
            end
        end
    end
    local function CanTeleport()
        local now = tick()
        local delta = now - lastTeleport
        if delta < TELEPORT_COOLDOWN then
            local remaining = TELEPORT_COOLDOWN - delta
            game.StarterGui:SetCore("SendNotification", {
                Title = "TP Cooldown",
                Text = "Wait " .. string.format("%.1f", remaining) .. "s before teleporting again"
            })
            return false
        end
        lastTeleport = now
        return true
    end
    local ScreenGui = Instance.new("ScreenGui")
    local Frame = Instance.new("Frame")
    local Scrolling = Instance.new("ScrollingFrame")
    local UIStroke = Instance.new("UIStroke")
    local UICorner = Instance.new("UICorner")
    local UIListLayout = Instance.new("UIListLayout")
    local Title = Instance.new("TextLabel")
    local Buttons = {
        { name="CrimBaseTP", text="TP to Crim Base" },
        { name="PrisonTP", text="TP to Prison" },
        { name ="GuardRoomTP", text="TP in Guard Room"},
        { name="ModGguns", text="Mod All Guns" },
        { name = "GetRem", text="Get Rem (shotgun)"},
        { name = "GetM9", text="Get MP5 (ar)"},
        { name = "GetFAL", text = "Get FAL (paid/ar)"},
        { name = "GetAK", text = "Get AK47 (ar)"},
        { name = "GetM4", text = "Get M4A1 (paid/ar)"},
        { name = "ToggleESP", text = "Toggle ESP (OFF)"},
        { name = "ArrestPlayer", text = "Arrest Player"},
        { name = "CancelArrest", text = "Cancel Arrest"}
    }

    local arrestGui = nil
    local arrestConnection = nil

    local function CloseArrestGui()
        if arrestGui then
            arrestGui:Destroy()
            arrestGui = nil
        end
        if arrestConnection then
            pcall(function()
                task.cancel(arrestConnection)
            end)
            arrestConnection = nil
        end
    end

    local function GetArrestableTargets()
        local targets = {}
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character then
                local isTrespassing = player.Character:GetAttribute("Trespassing")
                local teamName = player.Team and player.Team.Name or ""
                if isTrespassing or teamName == "Criminals" then
                    table.insert(targets, player)
                end
            end
        end
        return targets
    end

    local activeArrestConnection = nil
    local originalArrestPosition = nil
    local antiSitConnection = nil
    local arrestHighlight = nil
    local currentArrestTarget = nil
    local deathConnection = nil
    local arrestFloor = nil

    local function StopArresting()
        if activeArrestConnection then
            activeArrestConnection:Disconnect()
            activeArrestConnection = nil
        end
        if antiSitConnection then
            antiSitConnection:Disconnect()
            antiSitConnection = nil
        end
        if deathConnection then
            deathConnection:Disconnect()
            deathConnection = nil
        end
        if arrestHighlight then
            arrestHighlight:Destroy()
            arrestHighlight = nil
        end
        if arrestFloor then
            arrestFloor:Destroy()
            arrestFloor = nil
        end
        currentArrestTarget = nil
        if originalArrestPosition then
            local myHRP = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if myHRP then
                myHRP.CFrame = originalArrestPosition
            end
            originalArrestPosition = nil
        end
    end

    local function StartArresting(targetPlayer)
        CloseArrestGui()
        StopArresting()
        
        currentArrestTarget = targetPlayer
        
        local myHRP = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if myHRP then
            originalArrestPosition = myHRP.CFrame
        end
        
        if not ESP_ENABLED and targetPlayer.Character then
            arrestHighlight = Instance.new("Highlight")
            arrestHighlight.Name = "ArrestTargetHighlight"
            arrestHighlight.Adornee = targetPlayer.Character
            arrestHighlight.Parent = targetPlayer.Character
            arrestHighlight.FillColor = Color3.fromRGB(255, 0, 0)
            arrestHighlight.OutlineColor = Color3.fromRGB(255, 255, 0)
            arrestHighlight.FillTransparency = 0.5
            arrestHighlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        end
        
        local myHum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if myHum then
            deathConnection = myHum.Died:Connect(function()
                game.StarterGui:SetCore("SendNotification", {Title = "Arrest", Text = "You died, arrest cancelled"})
                StopArresting()
            end)
        end
        
        arrestFloor = Instance.new("Part")
        arrestFloor.Name = "ArrestFloor"
        arrestFloor.Size = Vector3.new(6, 1, 6)
        arrestFloor.Anchored = true
        arrestFloor.CanCollide = true
        arrestFloor.Transparency = 1
        arrestFloor.Parent = workspace
        
        local TIMEOUT = 30
        local startTime = tick()
        local lastArrestCall = 0
        local arrested = false
        
        antiSitConnection = RunService.RenderStepped:Connect(function()
            local hum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if hum and hum.Sit then
                hum.Sit = false
                hum:ChangeState(Enum.HumanoidStateType.GettingUp)
            end
        end)
        
        activeArrestConnection = RunService.RenderStepped:Connect(function()
            if arrested then return end
            
            if not targetPlayer or not targetPlayer.Character then
                game.StarterGui:SetCore("SendNotification", {Title = "Arrest", Text = "Target left or died"})
                StopArresting()
                return
            end
            
            local isTrespassing = targetPlayer.Character:GetAttribute("Trespassing")
            local teamName = targetPlayer.Team and targetPlayer.Team.Name or ""
            if not isTrespassing and teamName ~= "Criminals" then
                game.StarterGui:SetCore("SendNotification", {Title = "Arrest", Text = "Target is no longer arrestable"})
                StopArresting()
                return
            end
            
            if tick() - startTime > TIMEOUT then
                game.StarterGui:SetCore("SendNotification", {Title = "Arrest", Text = "Arrest timed out after " .. TIMEOUT .. " seconds"})
                StopArresting()
                return
            end
            
            local head = targetPlayer.Character:FindFirstChild("Head")
            if head and head:FindFirstChild("handcuffedGui") then
                arrested = true
                game.StarterGui:SetCore("SendNotification", {Title = "Arrest", Text = targetPlayer.Name .. " has been arrested!"})
                StopArresting()
                return
            end
            
            local targetHRP = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
            local myCharHRP = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if targetHRP and myCharHRP then
                local targetPos = targetHRP.Position
                local undergroundY = targetPos.Y - 6
                myCharHRP.CFrame = CFrame.new(targetPos.X, undergroundY, targetPos.Z) * CFrame.Angles(targetHRP.CFrame:ToEulerAnglesYXZ())
                if arrestFloor then
                    arrestFloor.CFrame = CFrame.new(targetPos.X, undergroundY - 3.5, targetPos.Z)
                end
            end
            
            if tick() - lastArrestCall >= 3 then
                lastArrestCall = tick()
                pcall(function()
                    local handcuffs = LocalPlayer.Backpack:FindFirstChild("Handcuffs") or (LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Handcuffs"))
                    if handcuffs and handcuffs.Parent == LocalPlayer.Backpack then
                        local hum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
                        if hum then
                            hum:EquipTool(handcuffs)
                        end
                    end
                end)
                pcall(function()
                    local args = {
                        game:GetService("Players"):WaitForChild(targetPlayer.Name)
                    }
                    game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("ArrestPlayer"):InvokeServer(unpack(args))
                end)
            end
        end)
    end

    local function ShowArrestGui()
        CloseArrestGui()
        
        local targets = GetArrestableTargets()
        if #targets == 0 then
            game.StarterGui:SetCore("SendNotification", {Title = "Arrest", Text = "No arrestable players found"})
            return
        end
        
        arrestGui = Instance.new("Frame")
        arrestGui.Name = "ArrestSelectGui"
        arrestGui.Parent = Frame
        arrestGui.BackgroundTransparency = 0.7
        arrestGui.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        arrestGui.Position = UDim2.new(1.05, 0, 0, 0)
        arrestGui.Size = UDim2.new(0, 250, 0, 260)
        
        local arrestStroke = Instance.new("UIStroke")
        arrestStroke.Parent = arrestGui
        arrestStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        arrestStroke.Thickness = 2
        arrestStroke.Color = Color3.fromRGB(255, 80, 80)
        
        local arrestCorner = Instance.new("UICorner")
        arrestCorner.Parent = arrestGui
        
        local arrestTitle = Instance.new("TextLabel")
        arrestTitle.Parent = arrestGui
        arrestTitle.Size = UDim2.new(1, 0, 0, 40)
        arrestTitle.BackgroundTransparency = 1
        arrestTitle.Text = "Select Target"
        arrestTitle.Font = Enum.Font.GothamBlack
        arrestTitle.TextSize = 18
        arrestTitle.TextColor3 = Color3.fromRGB(255, 50, 50)
        
        local closeBtn = Instance.new("TextButton")
        closeBtn.Parent = arrestGui
        closeBtn.Size = UDim2.new(0, 30, 0, 30)
        closeBtn.Position = UDim2.new(1, -35, 0, 5)
        closeBtn.BackgroundTransparency = 0.6
        closeBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        closeBtn.Text = "X"
        closeBtn.Font = Enum.Font.GothamBold
        closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        closeBtn.TextSize = 14
        Instance.new("UICorner", closeBtn)
        closeBtn.MouseButton1Click:Connect(CloseArrestGui)
        
        local arrestScroll = Instance.new("ScrollingFrame")
        arrestScroll.Parent = arrestGui
        arrestScroll.Position = UDim2.new(0, 0, 0, 40)
        arrestScroll.Size = UDim2.new(1, 0, 1, -40)
        arrestScroll.BackgroundTransparency = 1
        arrestScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
        arrestScroll.ScrollBarThickness = 4
        arrestScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
        arrestScroll.ScrollingDirection = Enum.ScrollingDirection.Y
        
        local arrestLayout = Instance.new("UIListLayout")
        arrestLayout.Parent = arrestScroll
        arrestLayout.Padding = UDim.new(0, 8)
        arrestLayout.FillDirection = Enum.FillDirection.Vertical
        arrestLayout.SortOrder = Enum.SortOrder.LayoutOrder
        arrestLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
        
        for _, targetPlayer in ipairs(targets) do
            local isTrespassing = targetPlayer.Character and targetPlayer.Character:GetAttribute("Trespassing")
            local teamName = targetPlayer.Team and targetPlayer.Team.Name or ""
            
            local statusText = ""
            if isTrespassing then
                statusText = " [Trespassing]"
            end
            if teamName == "Criminals" then
                statusText = statusText .. " [Criminal]"
            end
            
            local targetBtn = Instance.new("TextButton")
            targetBtn.Parent = arrestScroll
            targetBtn.Size = UDim2.new(0.9, 0, 0, 35)
            targetBtn.BackgroundTransparency = 0.6
            targetBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            targetBtn.Text = targetPlayer.Name .. statusText
            targetBtn.Font = Enum.Font.GothamBold
            targetBtn.TextColor3 = teamName == "Criminals" and Color3.fromRGB(255, 80, 80) or Color3.fromRGB(255, 170, 0)
            targetBtn.TextScaled = true
            Instance.new("UICorner", targetBtn)
            
            targetBtn.MouseEnter:Connect(function()
                targetBtn.BackgroundTransparency = 0.3
            end)
            targetBtn.MouseLeave:Connect(function()
                targetBtn.BackgroundTransparency = 0.6
            end)
            
            targetBtn.MouseButton1Click:Connect(function()
                game.StarterGui:SetCore("SendNotification", {Title = "Arrest", Text = "Arresting " .. targetPlayer.Name .. "..."})
                StartArresting(targetPlayer)
            end)
        end
        
        arrestConnection = task.spawn(function()
            while true do
                for i = 0, 1, 0.01 do
                    if not arrestGui then break end
                    arrestStroke.Color = Color3.fromHSV(i, 1, 1)
                    arrestTitle.TextColor3 = Color3.fromHSV(i, 1, 1)
                    task.wait(0.02)
                end
                if not arrestGui then break end
            end
        end)
    end
    ScreenGui.Parent = game:WaitForChild("CoreGui")
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    Frame.Parent = ScreenGui
    Frame.BackgroundTransparency = 0.7
    Frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    Frame.Position = UDim2.new(0.35, 0, 0.25, 0)
    Frame.Size = UDim2.new(0, 300, 0, 260)
    UIStroke.Parent = Frame
    UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    UIStroke.Thickness = 2
    UIStroke.Color = Color3.fromRGB(255, 80, 80)
    UICorner.Parent = Frame
    Title.Parent = Frame
    Title.Size = UDim2.new(1, 0, 0, 50)
    Title.BackgroundTransparency = 1
    Title.Text = "ULTRA SIGMA HAX V2"
    Title.Font = Enum.Font.GothamBlack
    Title.TextSize = 24
    Title.TextColor3 = Color3.fromRGB(255, 50, 50)
    Scrolling.Parent = Frame
    Scrolling.Position = UDim2.new(0, 0, 0, 50)
    Scrolling.Size = UDim2.new(1, 0, 1, -50)
    Scrolling.BackgroundTransparency = 1
    Scrolling.CanvasSize = UDim2.new(0, 0, 0, 0)
    Scrolling.ScrollBarThickness = 4
    Scrolling.AutomaticCanvasSize = Enum.AutomaticSize.Y
    Scrolling.ScrollingDirection = Enum.ScrollingDirection.Y
    UIListLayout.Parent = Scrolling
    UIListLayout.Padding = UDim.new(0, 10)
    UIListLayout.FillDirection = Enum.FillDirection.Vertical
    UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    for _, info in ipairs(Buttons) do
        local btn = Instance.new("TextButton")
        btn.Name = info.name
        btn.Parent = Scrolling
        btn.Size = UDim2.new(0.85, 0, 0, 40)
        btn.BackgroundTransparency = 0.6
        btn.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        btn.Text = info.text
        btn.Font = Enum.Font.GothamBold
        btn.TextColor3 = Color3.fromRGB(255, 255, 255)
        btn.TextScaled = true
        Instance.new("UICorner", btn)
        btn.MouseEnter:Connect(function()
            btn.BackgroundTransparency = 0.3
        end)
        btn.MouseLeave:Connect(function()
            btn.BackgroundTransparency = 0.6
        end)
        btn.MouseButton1Click:Connect(function()
            if info.name == "ModGguns" then
                game.StarterGui:SetCore("SendNotification", {Text="Make sure you aren't holding any guns rn", Title="Modded shit idfk"})
                for i, v in pairs(LocalPlayer.Backpack:GetChildren()) do
                    if v:GetAttribute("FireRate") ~= nil then
                        v:SetAttribute("FireRate", 0.02)
                        v:SetAttribute("AutoFire", true)
                        v:SetAttribute("SpreadRadius", 0)
                        game.StarterGui:SetCore("SendNotification", {Text="Modded " .. v.Name .. " successfully!", Title="Modded shit idfk"})
                    end
                end
            elseif info.name == "CrimBaseTP" then
                if CanTeleport() then
                    LocalPlayer.Character.HumanoidRootPart.CFrame = workspace["Criminals Spawn"].SpawnLocation.CFrame
                end
            elseif info.name == "PrisonTP" then
                if CanTeleport() then
                    LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(916, 100, 2369)
                end
            elseif info.name == "GuardRoomTP" then
                if CanTeleport() then
                    LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(828, 100, 2303)
                end
            elseif info.name == "GetRem" then
                if CanTeleport() then
                    LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(820, 101, 2229)
                end
            elseif info.name == "GetM9" then
                if CanTeleport() then
                    LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(814, 101, 2229)
                end
            elseif info.name == "GetFAL" then
                if CanTeleport() then
                    LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(-916, 94, 2048)
                end
            elseif info.name == "GetM4" then
                if CanTeleport() then
                    LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(848, 101, 2229)
                end
            elseif info.name == "GetAK" then
                if CanTeleport() then
                    LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(-931, 94, 2039)
                end
            elseif info.name == "ToggleESP" then
                ESP_ENABLED = not ESP_ENABLED
                btn.Text = "Toggle ESP (" .. (ESP_ENABLED and "ON" or "OFF") .. ")"
                UpdateESP()
            elseif info.name == "ArrestPlayer" then
                ShowArrestGui()
            elseif info.name == "CancelArrest" then
                if currentArrestTarget then
                    game.StarterGui:SetCore("SendNotification", {Title = "Arrest", Text = "Arrest cancelled"})
                    StopArresting()
                else
                    game.StarterGui:SetCore("SendNotification", {Title = "Arrest", Text = "No active arrest to cancel"})
                end
            end
        end)
    end

    local arrestButton = Scrolling:FindFirstChild("ArrestPlayer")
    local cancelArrestButton = Scrolling:FindFirstChild("CancelArrest")

    task.spawn(function()
        while true do
            local isGuard = LocalPlayer.Team and LocalPlayer.Team.Name == "Guards"
            if arrestButton then
                arrestButton.Visible = isGuard
                if not isGuard then
                    CloseArrestGui()
                end
            end
            if cancelArrestButton then
                cancelArrestButton.Visible = isGuard and currentArrestTarget ~= nil
            end
            task.wait(0.5)
        end
    end)

    local UIS = game:GetService("UserInputService")
    local dragging = false
    local dragStart, startPos

    Frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = Frame.Position
        end
    end)

    Frame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)

    UIS.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)

    task.spawn(function()
        while true do
            for i = 0, 1, 0.01 do
                UIStroke.Color = Color3.fromHSV(i, 1, 1)
                task.wait(0.02)
            end
        end
    end)
    task.spawn(function()
        while true do
            for i = 0, 1, 0.01 do
                Title.TextColor3 = Color3.fromHSV(i, 1, 1)
                task.wait(0.02)
            end
        end
    end)
    game.StarterGui:SetCore("SendNotification", {Text = "Loaded Successfully", Title = "ULTRA SIGMA HAX V2 >:3c"})
    RunService.RenderStepped:Connect(UpdateESP)
end

-- WORKING FLY SYSTEM
local FlyEnabled = false
local BodyGyro, BodyVelocity

local function ToggleFly()
    FlyEnabled = not FlyEnabled
    
    if FlyEnabled then
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local root = player.Character.HumanoidRootPart
            
            BodyGyro = Instance.new("BodyGyro")
            BodyGyro.P = 1000
            BodyGyro.D = 50
            BodyGyro.MaxTorque = Vector3.new(100000, 100000, 100000)
            BodyGyro.CFrame = root.CFrame
            BodyGyro.Parent = root
            
            BodyVelocity = Instance.new("BodyVelocity")
            BodyVelocity.Velocity = Vector3.new(0, 0, 0)
            BodyVelocity.MaxForce = Vector3.new(100000, 100000, 100000)
            BodyVelocity.Parent = root
            
            local flyConnection
            flyConnection = RunService.Heartbeat:Connect(function()
                if not FlyEnabled or not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then
                    flyConnection:Disconnect()
                    return
                end
                
                local root = player.Character.HumanoidRootPart
                local camera = workspace.CurrentCamera
                
                BodyGyro.CFrame = camera.CFrame
                
                local velocity = Vector3.new(0, 0, 0)
                local speed = 50
                
                if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                    velocity = velocity + camera.CFrame.LookVector * speed
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                    velocity = velocity - camera.CFrame.LookVector * speed
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                    velocity = velocity - camera.CFrame.RightVector * speed
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                    velocity = velocity + camera.CFrame.RightVector * speed
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                    velocity = velocity + Vector3.new(0, speed, 0)
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
                    velocity = velocity - Vector3.new(0, speed, 0)
                end
                
                BodyVelocity.Velocity = velocity
            end)
        end
    else
        if BodyGyro then BodyGyro:Destroy() end
        if BodyVelocity then BodyVelocity:Destroy() end
    end
end

-- Collision System
local function EnableCollision()
    for _, target in ipairs(Players:GetPlayers()) do
        if target.Character then
            for _, part in pairs(target.Character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = true
                end
            end
        end
    end
end

-- Orbit Fling
local OrbitalActive = false
local function GetNearestPlayer()
    local nearestPlayer = nil
    local shortestDistance = math.huge
    
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local playerRoot = player.Character.HumanoidRootPart
        
        for _, target in ipairs(Players:GetPlayers()) do
            if target ~= player and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
                local targetRoot = target.Character.HumanoidRootPart
                local distance = (playerRoot.Position - targetRoot.Position).Magnitude
                
                if distance < shortestDistance then
                    shortestDistance = distance
                    nearestPlayer = target
                end
            end
        end
    end
    
    return nearestPlayer
end

local function OrbitalFling()
    OrbitalActive = true
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end
    
    local root = player.Character.HumanoidRootPart
    
    spawn(function()
        while OrbitalActive and player.Character do
            local nearestTarget = GetNearestPlayer()
            
            if nearestTarget and nearestTarget.Character and nearestTarget.Character:FindFirstChild("HumanoidRootPart") then
                local targetRoot = nearestTarget.Character.HumanoidRootPart
                
                local angle = tick() * 8
                local radius = 6
                local orbitPosition = targetRoot.Position + Vector3.new(
                    math.cos(angle) * radius,
                    2,
                    math.sin(angle) * radius
                )
                
                root.CFrame = CFrame.new(orbitPosition)
                
                local flingBV = Instance.new("BodyVelocity")
                local flingDirection = (targetRoot.Position - root.Position).Unit
                flingBV.Velocity = flingDirection * 80 + Vector3.new(0, 60, 0)
                flingBV.MaxForce = Vector3.new(40000, 40000, 40000)
                flingBV.Parent = targetRoot
                game.Debris:AddItem(flingBV, 0.2)
            end
            
            RunService.Heartbeat:Wait()
        end
    end)
end

-- ORIGINAL FEATURE NAMES + NEW SCRIPTS ADDED
local CrownFunctions = {
    ["Fling"] = {
        {"ðŸŒ€ Orbit Nearest", function()
            OrbitalActive = not OrbitalActive
            if OrbitalActive then
                OrbitalFling()
            end
        end},
        
        {"ðŸ”’ Enable Collision", function()
            EnableCollision()
        end},
        
        {"ðŸ›‘ Stop Fling", function()
            OrbitalActive = false
        end}
    },
    
    ["Admin"] = {
        {"ðŸ›¡ï¸ Nameless Admin", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/ltseverydayyou/Nameless-Admin/main/Source"))()
        end},
        
        {"âš¡ Infinite Yield", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))()
        end},
        
        {"ðŸ¤– QuizBot", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/Damian-11/quizbot/master/quizbot.luau"))()
        end},
        
        {"ðŸ”¤ Chat Bypasser", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/AnnaRoblox/AnnaBypasser/refs/heads/main/AnnaBypasser.lua",true))()
        end}
    },
    
    Movement = {
        {"ðŸš€ Fly (WASD+Space+Ctrl)", function()
            ToggleFly()
        end},
        
        {"âš¡ Speed (100)", function()
            if player.Character and player.Character:FindFirstChild("Humanoid") then
                player.Character.Humanoid.WalkSpeed = 100
            end
        end},
        
        {"ðŸ‘» Noclip", function()
            local noclip = false
            player.CharacterAdded:Connect(function(char)
                if noclip then
                    wait(0.5)
                    for _, part in pairs(char:GetDescendants()) do
                        if part:IsA("BasePart") then
                            part.CanCollide = false
                        end
                    end
                end
            end)
            
            noclip = not noclip
            if player.Character then
                for _, part in pairs(player.Character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = not noclip
                    end
                end
            end
        end},
        
        {"ðŸ”„ Reset", function()
            if player.Character and player.Character:FindFirstChild("Humanoid") then
                player.Character.Humanoid.WalkSpeed = 16
            end
            ToggleFly()
        end}
    },
    
    Visual = {
        {"ðŸŽ¯ ESP", function()
            for _, target in ipairs(Players:GetPlayers()) do
                if target ~= player and target.Character then
                    local highlight = Instance.new("Highlight")
                    highlight.FillColor = Color3.fromRGB(255, 215, 0)
                    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                    highlight.FillTransparency = 0.4
                    highlight.Parent = target.Character
                end
            end
        end},
        
        {"ðŸ‘ï¸ X-Ray", function()
            for _, part in pairs(workspace:GetDescendants()) do
                if part:IsA("BasePart") and part.Transparency < 1 then
                    part.LocalTransparencyModifier = 0.6
                end
            end
        end},
        
        {"ðŸŒŸ Full Bright", function()
            Lighting.Brightness = 2
            Lighting.Ambient = Color3.new(1, 1, 1)
        end},
        
        {"ðŸ—‘ï¸ Clear", function()
            for _, target in ipairs(Players:GetPlayers()) do
                if target.Character then
                    for _, highlight in ipairs(target.Character:GetChildren()) do
                        if highlight:IsA("Highlight") then
                            highlight:Destroy()
                        end
                    end
                end
            end
            for _, part in pairs(workspace:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.LocalTransparencyModifier = 0
                end
            end
            Lighting.Brightness = 1
        end}
    },
    
    Combat = {
        {"ðŸŽ¯ Venum Aim", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/spicysharwarma-stack/VENUM.AIM/main/MAINCODE"))()
        end},
        
        {"âš¡ Aim Assist", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/RunDTM/ZeeroxHub/main/Loader.lua"))()
        end},
        
        {"ðŸ”« Prison Life Kill", function()
            LoadUltraSigmaHax()
        end},
        
        {"ðŸ“¡ Influence ESP", function()
            LoadInfluenceESP()
        end}
    },
    
    Hubs = {
        {"ðŸ”ª Slicer FE V8", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/Ahma174/Slicer/refs/heads/main/Slicer%20Fe%20V8.0.0%20%5BBETA%5D.txt"))()
        end},
        
        {"ðŸŒ€ Gravity Trip", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/Rawbr10/Roblox-Scripts/refs/heads/main/0%20Graviy%20Trip%20Universal"))()
        end},
        
        {"ðŸ¹ FE Hamster Ball", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/KaterHub-Inc/scripts/refs/heads/main/unofficial-Projects/FEHamsterBall.lua"))()
        end}
    },
    
    ["Fun"] = {
        {"ðŸš— Universal Vehicle", function()
            LoadUniversalVehicle()
        end},
        
        {"ðŸ’ƒ Tenna Dance", function()
            TennaDance()
        end}
    }
}

function UpdateContent()
    for _, child in ipairs(ContentFrame:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    
    local functions = CrownFunctions[CurrentTab] or {}
    
    for _, func in ipairs(functions) do
        CreateButton(func[1], func[2])
    end
end

function CreateButton(text, callback)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, 0, 0, IS_MOBILE and 38 or 42)
    button.BackgroundColor3 = Color3.fromRGB(35, 30, 45)
    button.BackgroundTransparency = 0.2
    button.Text = text
    button.TextColor3 = Color3.fromRGB(240, 230, 255)
    button.Font = Enum.Font.GothamMedium
    button.TextSize = IS_MOBILE and 12 or 13
    button.AutoButtonColor = false
    button.ZIndex = 11
    button.Parent = ContentFrame
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 8)
    buttonCorner.Parent = button
    
    -- Button Hover (only on PC)
    if not IS_MOBILE then
        button.MouseEnter:Connect(function()
            TweenService:Create(button, TweenInfo.new(0.3), {
                BackgroundTransparency = 0.1,
                BackgroundColor3 = Color3.fromRGB(45, 40, 55),
                Size = UDim2.new(1, 5, 0, 45)
            }):Play()
        end)
        
        button.MouseLeave:Connect(function()
            TweenService:Create(button, TweenInfo.new(0.3), {
                BackgroundTransparency = 0.2,
                BackgroundColor3 = Color3.fromRGB(35, 30, 45),
                Size = UDim2.new(1, 0, 0, 42)
            }):Play()
        end)
    end
    
    button.MouseButton1Click:Connect(function()
        -- Click animation
        TweenService:Create(button, TweenInfo.new(0.1), {
            BackgroundColor3 = Color3.fromRGB(212, 175, 55),
            TextColor3 = Color3.fromRGB(20, 15, 25),
            Size = UDim2.new(1, IS_MOBILE and -3 or -5, 0, IS_MOBILE and 35 or 38)
        }):Play()
        wait(0.1)
        TweenService:Create(button, TweenInfo.new(0.3), {
            BackgroundColor3 = Color3.fromRGB(35, 30, 45),
            TextColor3 = Color3.fromRGB(240, 230, 255),
            Size = UDim2.new(1, 0, 0, IS_MOBILE and 38 or 42)
        }):Play()
        
        pcall(callback)
    end)
end

-- Minimize
local Minimized = false
MinimizeButton.MouseButton1Click:Connect(function()
    Minimized = not Minimized
    if Minimized then
        TweenService:Create(MainContainer, TweenInfo.new(0.3), {
            Size = UDim2.new(0, UI_WIDTH * UI_SCALE, 0, IS_MOBILE and 60 or 70)
        }):Play()
        MinimizeButton.Text = "+"
    else
        TweenService:Create(MainContainer, TweenInfo.new(0.3), {
            Size = UDim2.new(0, UI_WIDTH * UI_SCALE, 0, UI_HEIGHT * UI_SCALE)
        }):Play()
        MinimizeButton.Text = "_"
    end
end)

-- Control Button Hover (only on PC)
if not IS_MOBILE then
    MinimizeButton.MouseEnter:Connect(function()
        TweenService:Create(MinimizeButton, TweenInfo.new(0.2), {
            BackgroundTransparency = 0,
            Size = UDim2.new(0, 32, 0, 32)
        }):Play()
    end)
    
    MinimizeButton.MouseLeave:Connect(function()
        TweenService:Create(MinimizeButton, TweenInfo.new(0.2), {
            BackgroundTransparency = 0.2,
            Size = UDim2.new(0, 30, 0, 30)
        }):Play()
    end)
    
    CloseButton.MouseEnter:Connect(function()
        TweenService:Create(CloseButton, TweenInfo.new(0.2), {
            BackgroundTransparency = 0,
            Size = UDim2.new(0, 32, 0, 32)
        }):Play()
    end)
    
    CloseButton.MouseLeave:Connect(function()
        TweenService:Create(CloseButton, TweenInfo.new(0.2), {
            BackgroundTransparency = 0.2,
            Size = UDim2.new(0, 30, 0, 30)
        }):Play()
    end)
end

-- Drag System (PC only - mobile has touch drag)
if not IS_MOBILE then
    local dragging = false
    local dragStart, startPos

    Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainContainer.Position
        end
    end)

    Header.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)

    Header.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
            local delta = input.Position - dragStart
            MainContainer.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end

-- Close
CloseButton.MouseButton1Click:Connect(function()
    TweenService:Create(MainContainer, TweenInfo.new(0.4), {
        Size = UDim2.new(0, 0, 0, 0),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        BackgroundTransparency = 1
    }):Play()
    wait(0.4)
    CrownHub:Destroy()
end)

-- Entrance Animation
MainContainer.Size = UDim2.new(0, 0, 0, 0)
MainContainer.Position = UDim2.new(0.5, 0, 0.5, 0)
MainContainer.BackgroundTransparency = 1

wait(0.1)

TweenService:Create(MainContainer, TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
    Size = UDim2.new(0, UI_WIDTH * UI_SCALE, 0, UI_HEIGHT * UI_SCALE),
    Position = UDim2.new(0.5, -(UI_WIDTH * UI_SCALE) / 2, 0.5, -(UI_HEIGHT * UI_SCALE) / 2),
    BackgroundTransparency = 0.05
}):Play()

-- Initialize
UpdateContent()
UpdateTabAppearance()

print("ðŸ‘‘ Crown Hub - Universal Edition")
print("ðŸŒŸ Now in CoreGui - Always on top!")
print("âœ¨ IMPROVED glowing edge effect with UIStroke")
print("ðŸš— Universal Vehicle Script added to Fun tab")
print("ðŸ’ƒ Tenna Dance added to Fun tab (only one)")
print("ðŸ”« Prison Life Kill added to Combat tab")
print("ðŸ“¡ Influence ESP added to Combat tab")
print("ðŸ“± Mobile support - Universal Edition")
